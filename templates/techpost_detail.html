{% extends 'layout/layout.html' %}

{% block content %}
{% load static %}

<div style="padding-top: 100px;">
  <div class="post-wrapper">
      <div class="post-card">
          <h1 class="post-title">{{ post.title }}</h1>

          <!-- Post Row -->
          <div class="post-row">
              <div class="post-left">
                  {% if post.images.all %}
                      <img id="main-image" src="{{ post.images.all.0.image.url }}" alt="{{ post.title }}" loading="lazy">
                  {% endif %}
              </div>

              <div class="post-right">
                  <div class="note-container">
                      <p class="note">{{ post.note }}</p>
                  </div>
              </div>
          </div>

          <!-- Thumbnail Row -->
          <div class="thumbnail-row">
              {% for img in post.images.all %}
                  <img src="{{ img.image.url }}" class="thumbnail" alt="thumb {{ forloop.counter }}" loading="lazy">
              {% endfor %}
          </div>

          <!-- Last Updated -->
          <p class="meta">Last updated: 
                <span class="post-time" data-utc="{{ post.updated_at|date:'c' }}"></span>
          </p>

          <!-- Back Button -->
          <div class="back-container">
              <a href="{% url 'index' %}" class="back-btn">← Back to HOME</a>
          </div>
      </div>
  </div>
</div>

<style>
/* Wrapper */
.post-wrapper {
  width: 80%;          
  max-width: 1000px;
  margin: 0 auto;
  padding: 0 20px;
    aspect-ratio: 1/1;
}

/* Card */
.post-card {
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(12px);
  border-radius: 10px;
  padding: 25px;
  margin-bottom: 30px;
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.post-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 36px rgba(0,0,0,0.5);
}

/* Title */
.post-title {
  text-align: center;
  font-size: 2rem;
  margin-bottom: 15px;
  color: #fff;
  text-shadow: 0 0 6px rgba(0,255,0,0.5);
}

/* Post Row */
.post-row {
  display: flex;
  gap: 20px;
  flex-wrap: nowrap;  
}

.post-left {
  flex: 1 1 55%;
  max-width: 55%;
}

.post-left img {
  width: 100%;
  height: 500px;
  object-fit: cover;
  border-radius: 10px;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
  border: 2px solid rgba(255,255,255,0.1);
}
.post-left img:hover {
  transform: scale(1.03);
  box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}

.post-right {
  flex: 1 1 40%;
  max-width: 40%;
  display: flex;
  flex-direction: column;
}

.note-container {
  scroll-behavior: smooth;
  max-height: 500px; 
  overflow-y: auto;
  overflow-x: hidden;
  padding-right: 15px;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
.note-container::-webkit-scrollbar { display: none; }

.note {
  font-size: 1rem;
  line-height: 1.7;
  color: #e0e0e0;
  text-align: justify;
}

.thumbnail-row {
  display: flex;
  gap: 12px;
  margin-top: 15px;
  overflow-x: auto;
  overflow-y: hidden;
  padding-bottom: 5px;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
.thumbnail-row::-webkit-scrollbar { display: none; }

.thumbnail-row img {
  width: 180px;
  height: 180px;
  object-fit: cover;
  border-radius: 12px;
  cursor: pointer;
  flex-shrink: 0;
  border: 2px solid transparent;
  transition: transform 0.3s ease, border 0.3s ease, box-shadow 0.3s ease;
}
.thumbnail-row img:hover { transform: scale(1.08); box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
.thumbnail-row img.active { border: 2px solid #00ff99; }

/* Meta */
.meta {
  font-size: 0.85rem;
  color: #88ffaa;
  margin-top: 10px;
}

/* Back Button */
.back-container { margin-top: 30px; text-align: center; }
.back-btn {
  padding: 10px 20px;
  background: #092e20;
  color: #fff;
  border-radius: 8px;
  text-decoration: none;
}

@media (max-width: 900px){
  .post-wrapper { width: 90%; } 
  .post-row { flex-direction: row; }
  .post-left, .post-right { flex: 1 1 50%; max-width: 50%; }
  .post-left img { height: auto; width: 90%; aspect-ratio: 1/1; }
  .note-container { max-height: none; overflow-y: auto; margin-top: 15px; }
  .thumbnail-row img { width: 150px; height: 150px; }
}

@media (max-width: 600px){
  .post-wrapper { width: 100%; } 
  .post-row { flex-direction: column; }
  .post-left, .post-right { flex: 1 1 100%; max-width: 100%; }
  .thumbnail-row { overflow-x: auto; }
  .post-left img { height: auto; width: 100%; aspect-ratio: 1/1; }
  .note-container { max-height: auto; overflow-y: auto; margin-top: 15px; }
  .thumbnail-row img { width: 120px; height: 120px; }
  .post-title { font-size: 1.5rem; }
}
</style>

<script>
// UTC → Local Time
document.querySelectorAll('.post-time').forEach(el => {
    el.textContent = new Date(el.dataset.utc).toLocaleString();
});

// Thumbnail click
const mainImage = document.getElementById('main-image');
const thumbs = document.querySelectorAll('.thumbnail');

thumbs.forEach(t => {
    t.addEventListener('click', () => {
        mainImage.src = t.src;
        thumbs.forEach(x => x.classList.remove('active'));
        t.classList.add('active');
    });
});

// First thumbnail active
if (thumbs.length) thumbs[0].classList.add('active');

// Set note-container height same as image dynamically for all devices
function adjustNoteHeight() {
    const noteContainer = document.querySelector('.note-container');
    if(noteContainer && mainImage){
        noteContainer.style.maxHeight = mainImage.clientHeight + 'px';
    }
}

// Run on load and window resize
window.addEventListener('load', adjustNoteHeight);
window.addEventListener('resize', adjustNoteHeight);
</script>
{% endblock %}
